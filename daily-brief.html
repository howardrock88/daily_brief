<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§è’œç²’æœºç ”æ‰€è¡Œä¸šæ—©æŠ¥</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Noto Sans SC', sans-serif; }
    .card { transition: all 0.3s ease; }
    .card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
    .section-title { border-left: 4px solid; }
    .section-focus { border-color: #f97316; }
    .section-funding { border-color: #22c55e; }
    .section-tech { border-color: #3b82f6; }
    .section-news { border-color: #a855f7; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">ğŸ¤– å¤§è’œç²’æœºç ”æ‰€è¡Œä¸šæ—©æŠ¥</h1>
      <p class="text-purple-300 text-lg">æ¯å¤©è‡ªåŠ¨æ›´æ–° Â· æœºå™¨äººå’ŒAIè¡Œä¸šèµ„è®¯</p>
    </div>

    <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <div id="modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50" onclick="closeModal(event)">
      <div id="modal-content" class="bg-slate-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"></div>
    </div>

    <div class="mt-12 text-center text-purple-400 text-sm">
      ğŸ“ æ•°æ®æ¥æº: <a href="https://github.com/howardrock88/daily_brief" target="_blank" class="underline">GitHub</a>
    </div>
  </div>

  <script>
    let briefs = [];

    async function loadData() {
      try {
        const response = await fetch('daily-brief.json');
        if (!response.ok) throw new Error('åŠ è½½å¤±è´¥');
        briefs = await response.json();
        renderCards();
      } catch (e) {
        document.getElementById('cards').innerHTML = `
          <div class="col-span-full text-center py-12">
            <p class="text-red-400">âš ï¸ åŠ è½½å¤±è´¥: ${e.message}</p>
          </div>
        `;
      }
    }

    function getTotalItems(brief) {
      const keys = ['focus', 'funding', 'tech', 'news'];
      return keys.reduce((sum, key) => sum + (brief[key]?.length || 0), 0);
    }

    function getSummary(brief) {
      // ç„¦ç‚¹æ–°é—»æ ‡é¢˜åˆ—è¡¨
      return brief.focus?.map(f => f.title).join(' | ') || 'æš‚æ— ';
    }

    function renderCards() {
      const container = document.getElementById('cards');
      container.innerHTML = briefs.map((brief, idx) => `
        <div class="card bg-white/10 backdrop-blur rounded-2xl overflow-hidden cursor-pointer border border-white/10" onclick="openModal(${idx})">
          <div class="p-6">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h2 class="text-2xl font-bold text-white">${brief.date}</h2>
                <p class="text-purple-300 text-sm mt-1">ğŸ“° ${getTotalItems(brief)}æ¡èµ„è®¯</p>
              </div>
              <span class="text-3xl">ğŸ“‹</span>
            </div>
            
            <div class="pt-4 border-t border-white/10">
              <p class="text-orange-400 text-sm mb-2">ğŸ”¥ ç„¦ç‚¹</p>
              <p class="text-white leading-relaxed line-clamp-3">${brief.focus?.[0]?.title || 'æš‚æ— '}</p>
            </div>
            
            <div class="mt-4 flex flex-wrap gap-2">
              ${brief.funding?.length ? `<span class="px-2 py-1 bg-green-500/20 text-green-300 rounded text-xs">ğŸ’° ${brief.funding.length}</span>` : ''}
              ${brief.tech?.length ? `<span class="px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-xs">ğŸš€ ${brief.tech.length}</span>` : ''}
              ${brief.news?.length ? `<span class="px-2 py-1 bg-purple-500/20 text-purple-300 rounded text-xs">ğŸ­ ${brief.news.length}</span>` : ''}
            </div>
          </div>
          <div class="px-6 py-3 bg-white/5 text-center text-purple-300 text-sm">
            ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… â†’
          </div>
        </div>
      `).join('');
    }

    function parseSource(source) {
      if (!source) return '';
      const httpMatch = source.match(/https?:\/\/[^\s]+/);
      if (httpMatch) {
        const url = httpMatch[0];
        const name = source.replace(url, '').replace(/\|/g, '').trim();
        return `${name} <a href="${url}" target="_blank" class="text-purple-300 hover:text-purple-200 underline">ğŸ”— é“¾æ¥</a>`;
      }
      return source;
    }

    function openModal(idx) {
      const brief = briefs[idx];
      const modal = document.getElementById('modal');
      const content = document.getElementById('modal-content');

      const sections = [
        { key: 'focus', title: 'ğŸ”¥ ä»Šæ—¥ç„¦ç‚¹', color: 'text-orange-400', class: 'section-focus' },
        { key: 'funding', title: 'ğŸ’° èèµ„ä¸å¹¶è´­', color: 'text-green-400', class: 'section-funding' },
        { key: 'tech', title: 'ğŸš€ æŠ€æœ¯çªç ´', color: 'text-blue-400', class: 'section-tech' },
        { key: 'news', title: 'ğŸ­ è¡Œä¸šåŠ¨æ€', color: 'text-purple-400', class: 'section-news' }
      ];

      let html = `
        <div class="sticky top-0 bg-slate-800/95 p-6 border-b border-white/10 flex justify-between items-center">
          <div>
            <h2 class="text-2xl font-bold text-white">${brief.date}</h2>
            <p class="text-purple-300 text-sm">å¤§è’œç²’æœºç ”æ‰€è¡Œä¸šæ—©æŠ¥</p>
          </div>
          <button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl">Ã—</button>
        </div>
        <div class="p-6 space-y-6">
      `;

      for (const section of sections) {
        const items = brief[section.key];
        if (!items || items.length === 0) continue;

        html += `
          <div>
            <h3 class="text-xl font-bold ${section.color} mb-4 flex items-center gap-2 section-title ${section.class} pl-4">
              ${section.title}
            </h3>
            <div class="space-y-3 ${section.key === 'focus' ? 'md:grid md:grid-cols-2 md:gap-4' : ''}">
              ${items.map((item, i) => `
                <div class="bg-white/5 rounded-xl p-4">
                  <h4 class="font-bold text-white mb-2">${i + 1}. ${item.title}</h4>
                  <p class="text-purple-200 mb-3 leading-relaxed">${item.desc}</p>
                  <div class="text-sm text-purple-300">ğŸ“° ${parseSource(item.source)}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      html += `
          <div class="pt-6 border-t border-white/10 text-center">
            <p class="text-purple-400 text-sm">âœ… å·²æŸ¥é‡ | â° æ˜å¤©7:00è‡ªåŠ¨æ›´æ–°</p>
          </div>
        </div>
      `;

      content.innerHTML = html;
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(e) {
      if (!e || e.target === e.currentTarget) {
        const modal = document.getElementById('modal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
      }
    }

    loadData();
  </script>
</body>
</html>
